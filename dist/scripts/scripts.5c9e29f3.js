"use strict";angular.module("slangchatApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","firebase","firebase.ref","ui.materialize","ngStorage"]),angular.module("slangchatApp").controller("inicioNumero",["$scope","$window","$location","$http","$timeout","$firebaseArray","FBURL","$localStorage",function(a,b,c,d,e,f,g,h){void 0==h.numero?(a.modal=!1,a.inicio={pais:"Seleccion un pa√≠s"},a.enviarNumero=function(c){a.numero=c.numero,b.alert("Enviamos un SMS al numero: "+c.numero),d({url:"http://www.atomick.com.mx/slangchat/mensajes/codigo.php",method:"POST",data:{numero:c.numero}}).then(function(c){a.codigoServer=c,$("#modalCodigo").openModal(),a.modal=!0,b.console.log(a.codigoServer),e(function(){b.alert("Tu codigo es: "+a.codigoServer.data)},3e3)},function(a){b.alert("ocurrio un error, verifica tu conexion a internet "+a)})},a.verificar=function(d){if(a.codigoServer.data==d){var i=new Firebase(g).child("usuarios"),j=f(i);j.$loaded().then(function(){j.$add({numero:a.numero}).then(function(d){h.numero=a.numero,b.$("#modalCodigo").closeModal(),b.alert("el codigo coincide"),e(function(){c.url("chat")},1e3)})})}else b.alert("el codigo no es correcto, revisar")}):(b.console.log("con numero: "+h.numero),c.url("chat"))}]).config(["$httpProvider",function(a){a.defaults.headers.common={},a.defaults.headers.post={},a.defaults.headers.put={},a.defaults.headers.patch={}}]),angular.module("firebase.config",[]).constant("FBURL","https://sweltering-fire-109.firebaseio.com"),angular.module("firebase.ref",["firebase","firebase.config"]).factory("Ref",["$window","FBURL",function(a,b){return new a.Firebase(b)}]),angular.module("slangchatApp").controller("ChatCtrl",["$scope","$window","$firebaseArray","FBURL","$timeout","$localStorage",function(a,b,c,d,e,f){a.numero=f.numero;var g=new Firebase(d).child("usuarios"),h=c(g);h.$loaded().then(function(){a.usuarios=h,console.log(h.$keyAt),angular.forEach(h,function(e,f){var g=a.numero<e.numero?a.numero+e.numero:e.numero+a.numero,h=new Firebase(d).child("mensajes").child(g).orderByChild("timestamp").limitToLast(1),i=c(h);a.ultimosMensajes=[],i.$loaded().then(function(){b.console.log(i),i[0].grupoID=g,console.log(i),a.ultimosMensajes.push(i[0])})})}),a.unoauno=function(a,c){var d=c>a?a+c:c+a;b.location.href="#/conversacion/"+d},a.conversacion=function(a){var c=a;b.location.href="#/conversacion/"+c}}]),angular.module("slangchatApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),angular.module("slangchatApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/inicioNumero.html",controller:"inicioNumero"}).when("/chat",{templateUrl:"views/chat.html",controller:"ChatCtrl"}).when("/conversacion/:grupo",{templateUrl:"views/conversacion.html",controller:"ConversacionCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("slangchatApp").directive("footer",function(){return{template:"<div></div>",restrict:"E",link:function(a,b,c){b.text("this is the footer directive")}}}),angular.module("slangchatApp").controller("ConversacionCtrl",["$scope","FBURL","$firebaseArray","$window","$timeout","$routeParams","$localStorage",function(a,b,c,d,e,f,g){a.numero=g.numero;var h=f.grupo,i=new Firebase(b).child("mensajes").child(h).orderByChild("timestamp"),j=c(i);j.$loaded().then(function(){a.mensajes=j,console.log(j),e(function(){a.scroll=!0},2500)}),a.mensajesEnviar=function(b){a.mensajes.$add({numero:a.numero,mensaje:b,timestamp:Firebase.ServerValue.TIMESTAMP,nombre:"nombre prueba"}).then(function(b){a.mensaje="",d.console.log("insertado")})}}]);